# M9: Testing Strategy (Escalonado)

## OBJETIVO (OBJ)
Definir y configurar una estrategia de testing pragmática que aporte confianza sin ralentizar el desarrollo visual.

## ALCANCE (ALC)
- Unit Testing (Vitest).
- Integration/E2E básico (Playwright).
- Visual Regression (Opcional PRO).

## PASOS
1.  **Nivel 1: Obligatorio (Unit/Integration)**:
    - Configurar Vitest.
    - Tests obligatorios para:
        - Utilidades de negocio (`priceFormatter`, `dateHelpers`).
        - Validaciones de formularios complejos.
        - Hooks personalizados (`useCookieConsent`).
2.  **Nivel 2: Smoke Tests (E2E)**:
    - Configurar Playwright.
    - Test básico: La home carga, no hay errores de consola 500, navegación a `/contacto` funciona.
3.  **Nivel 3: Visual (Opcional)**:
    - Configurar Playwright para capturar screenshots y comparar con "Golden Images".
    - Útil para detectar regresiones de CSS global.

## CRITERIOS DE ACEPTACIÓN (AC)
- [ ] `npm test` ejecuta los unit tests.
- [ ] `npm run test:e2e` lanza un navegador headless y verifica healthcheck.
- [ ] Documentación de cómo escribir un test nuevo.

## EJECUCIÓN (EJ)
```typescript
// Integrarlo en /release_proof
await runCommand('npm test');
```

## RIESGOS
- Tests frágiles que se rompen con cambios de texto (usar `data-testid` o roles accesibles, no selectores de texto rígidos).
- Playwright es pesado; evaluar si mantenerlo en el step de CI o solo local/nightly.
